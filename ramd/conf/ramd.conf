# RAM PostgreSQL Auto-Failover Daemon Configuration
# Copyright (c) 2024-2025, pgElephant, Inc.

# =============================================================================
# CLUSTER CONFIGURATION
# =============================================================================

# Cluster identification
cluster_name = "ram_cluster"
cluster_id = 1

# Node identification
node_id = 1
node_name = "node1"
node_role = "primary"  # primary, standby, monitor

# =============================================================================
# NETWORK CONFIGURATION
# =============================================================================

# Binding addresses and ports
bind_address = "0.0.0.0"
ramd_port = 8000
http_api_port = 8008

# PostgreSQL connection settings
postgresql_host = "localhost"
postgresql_port = 5432
postgresql_user = "postgres"
postgresql_password = ""
postgresql_database = "postgres"

# =============================================================================
# POSTGRESQL CONFIGURATION
# =============================================================================

# Data directory paths
postgresql_data_dir = "/var/lib/postgresql/data"
postgresql_bin_dir = "/usr/bin"
postgresql_config_dir = "/etc/postgresql"

# PostgreSQL service management
postgresql_service_name = "postgresql"
postgresql_start_timeout = 60
postgresql_stop_timeout = 30

# =============================================================================
# REPLICATION CONFIGURATION
# =============================================================================

# Streaming replication settings
streaming_replication_enabled = true
max_wal_senders = 10
max_replication_slots = 10
wal_keep_segments = 64

# Synchronous replication
synchronous_replication_enabled = true
synchronous_commit = "remote_write"  # off, local, remote_write, remote_apply
num_sync_standbys = 1
sync_timeout_ms = 10000

# Replication lag monitoring
max_lag_on_failover = 300  # seconds
lag_check_interval = 10    # seconds

# =============================================================================
# FAILOVER CONFIGURATION
# =============================================================================

# Automatic failover
auto_failover_enabled = true
failover_timeout = 30      # seconds
failover_check_interval = 5  # seconds

# Failover criteria
primary_failure_timeout = 10    # seconds
network_partition_timeout = 15  # seconds
split_brain_prevention = true

# Node promotion
promotion_timeout = 60      # seconds
promotion_check_interval = 2   # seconds

# =============================================================================
# CONSENSUS AND LEADER ELECTION (RALE)
# =============================================================================

# RALE consensus settings
rale_enabled = true
rale_port = 7400
dstore_port = 7401

# Election timeouts
election_timeout_min = 150   # milliseconds
election_timeout_max = 300   # milliseconds
heartbeat_interval = 50      # milliseconds

# Quorum settings
quorum_size = 2
minimum_nodes = 3

# =============================================================================
# MONITORING AND HEALTH CHECKS
# =============================================================================

# Health check intervals
health_check_interval = 10      # seconds
node_status_check_interval = 5  # seconds
replication_status_check_interval = 5  # seconds

# Health check timeouts
health_check_timeout = 5        # seconds
connection_timeout = 10         # seconds

# Monitoring thresholds
max_connection_count = 1000
max_replication_lag = 300       # seconds
min_disk_space = 1073741824     # 1GB in bytes

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log levels: DEBUG, INFO, WARNING, ERROR
log_level = "INFO"
log_file = "/var/log/ramd/ramd.log"
log_to_syslog = true
log_to_console = true

# Log rotation
log_max_size = 104857600        # 100MB
log_max_files = 10
log_compress = true

# =============================================================================
# BACKUP AND RECOVERY
# =============================================================================

# Backup configuration
backup_enabled = true
backup_retention_days = 7
backup_schedule = "0 2 * * *"  # Daily at 2 AM

# WAL archiving
wal_archiving_enabled = true
archive_command = "test ! -f /var/lib/postgresql/archive/%f && cp %p /var/lib/postgresql/archive/%f"
archive_cleanup_command = "pg_archivecleanup /var/lib/postgresql/archive %r"

# Point-in-time recovery
pitr_enabled = true
pitr_retention_days = 30

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# Authentication
auth_enabled = false
auth_token = ""
auth_method = "token"  # token, basic, oauth

# SSL/TLS
ssl_enabled = false
ssl_cert_file = ""
ssl_key_file = ""
ssl_ca_file = ""

# Network security
allowed_hosts = "0.0.0.0/0"
firewall_rules_enabled = false

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# Connection pooling
max_connections = 100
connection_pool_size = 20
connection_pool_timeout = 30

# Memory settings
shared_buffers = "128MB"
work_mem = "4MB"
maintenance_work_mem = "64MB"

# Background processes
autovacuum_enabled = true
autovacuum_max_workers = 3
checkpoint_segments = 32

# =============================================================================
# MAINTENANCE MODE
# =============================================================================

# Maintenance operations
maintenance_mode_enabled = true
maintenance_timeout = 3600     # 1 hour
maintenance_drain_timeout = 300 # 5 minutes

# Planned failover
planned_failover_enabled = true
planned_failover_timeout = 300  # 5 minutes

# =============================================================================
# INTEGRATION SETTINGS
# =============================================================================

# External monitoring
prometheus_metrics_enabled = true
prometheus_port = 9090

# Alerting
alerting_enabled = false
alert_webhook_url = ""
alert_email_enabled = false
alert_email_smtp_server = ""
alert_email_from = ""
alert_email_to = ""

# =============================================================================
# ADVANCED SETTINGS
# =============================================================================

# Debug mode
debug_mode = false
trace_enabled = false

# Development settings
development_mode = false
hot_reload_enabled = false

# Custom scripts
pre_failover_script = ""
post_failover_script = ""
pre_promotion_script = ""
post_promotion_script = ""

# =============================================================================
# DEPRECATED SETTINGS (for backward compatibility)
# =============================================================================

# These settings are kept for compatibility but may be removed in future versions
legacy_mode = false

